<!DOCTYPE html>
<html lang="en">
<head>
  <title>Susanoo Users List</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
</head>
<body>

<div class="jumbotron text-center">
  <h1>Susanoo</h1>
  <p>Susanoo Users Management</p>
</div>

<div class="container">
  <table class="table table-striped table-hover">
    <thead class="thead-dark">
    <tr>
      <th>#</th>
      <th scope="col">id</th>
      <th scope="col">Name</th>
      <th scope="col">Email</th>
      <th scope="col">Mobile Number</th>
      <th scope="col">Verified?</th>
      <th scope="col">Action</th>
    </tr>
    </thead>
    <tbody id="table_content">

    </tbody>
  </table>
  <div class="card">
    <h5 class="card-header">Add new reporter</h5>
    <div class="card-body">
      <h5 class="card-title"></h5>
      <div id="message"></div>
      <form id="frmAddUser">
        <div class="form-group">
            <label for="exampleFormControlInput1">Full name</label>
            <input type="text" class="form-control" id="name" placeholder="name@example.com">
        </div>
        <div class="form-group">
            <label for="exampleFormControlInput1">Email address</label>
            <input type="email" class="form-control" id="email" placeholder="name@example.com">
        </div>
        <div class="form-group">
          <label for="exampleFormControlInput1">Mobile number</label>
          <input type="text" class="form-control" id="mobileNumber" placeholder="962123456789">
        </div>
        <div class="form-group">
            <label for="exampleFormControlInput1">Password</label>
            <input type="password" class="form-control" id="password" placeholder="">
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>
  </div>

</div>
<script>
    function delete_user(id){
        if (confirm('Are you sure you want to delete this?')) {
            $.ajax({
                type: "DELETE",
                url: '/api/v1/users/'+id,
                headers: {
                    'Content-Type': 'application/json'
                },
                success: function(result) {
                    location.reload()
                }

            });
        }
    }
    $('#frmAddUser').on('submit',function(e){
        e.preventDefault();
        $("#message").html('<div class="alert alert-warning" role="alert">Loading.....</div>');
        $("#frmAddUser").hide()
        var settings = {
            "url": "/api/v1/users",
            "method": "POST",
            "headers": {
                "content-type": "application/json",
            },
            "contentType": "application/json;charset=utf-8",
            "dataType": "json",
            "data": JSON.stringify({
                "email": $("#email").val(),
                "mobileNumber": $("#mobileNumber").val(),
                "password": $("#password").val(),
                "name": $("#name").val()
            }),
            success:  function(responseText, statusText, xhr, $form) {
                $("#message").html('<div class="alert alert-success" role="alert">' +
                            'User created, please check otp password!' + '</div>');
                loadUsers();
                $("#frmAddUser").show()
            },
            error:  function(responseText, statusText, xhr, $form) {
                $("#message").html('<div class="alert alert-danger" role="alert">' +
                        responseText.responseJSON.message + '</div>');
                $("#frmAddUser").show()
            }
            }

        $.ajax(settings).done(function (response) {
            //console.log(response)
        });

    })

    function loadUsers(){
        $("#table_content").html('')
        $.ajax({ url: "/api/v1/users",
            context: document.body,
            success: function(result){
                $.each(result.data, function( index, value ) {
                    ++index
                    if (value.role !== "ROLE_SUPERADMIN") {
                        $("#table_content").append("<tr><th scope='row'>"+index+"</th><td>"+value.id+"</td><td>"+value.name+"</td><td>"+value.email+"</td><td>"+value.mobileNumber+"</td><td>"+value.isVerified+"</td><td><span onclick=delete_user('"+value.id+"') style='display:inline-block;padding:5px;border-radius:5px;background:#ccc;color:#fff;cursor:pointer'>Delete</span></td></tr>")
                    }else{
                        $("#table_content").append("<tr><th scope='row'>"+index+"</th><td>"+value.id+"</td><td>"+value.name+"</td><td>"+value.email+"</td><td>"+value.mobileNumber+"</td><td>"+value.isVerified+"</td><td>-</td></tr>")
                    }
                });

            }});
    }
    $(document).ready(function(){
        loadUsers()
    });
</script>
</body>
</html>





